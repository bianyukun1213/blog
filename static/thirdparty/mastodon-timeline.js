const MastodonApi=function(t){this.CONTAINER_BODY_ID=t.container_body_id||"mt-body",this.SPINNER_CLASS=t.spinner_class||"loading-spinner",this.DEFAULT_THEME=t.default_theme||"auto",this.INSTANCE_URL=t.instance_url,this.USER_ID=t.user_id||"",this.PROFILE_NAME=this.USER_ID?t.profile_name:"",this.TIMELINE_TYPE=t.timeline_type||"local",this.HASHTAG_NAME=t.hashtag_name||"",this.TOOTS_LIMIT=t.toots_limit||"20",this.HIDE_UNLISTED=void 0!==t.hide_unlisted&&t.hide_unlisted,this.HIDE_REBLOG=void 0!==t.hide_reblog&&t.hide_reblog,this.HIDE_REPLIES=void 0!==t.hide_replies&&t.hide_replies,this.HIDE_PREVIEW_LINK=void 0!==t.hide_preview_link&&t.hide_preview_link,this.HIDE_EMOJOS=void 0!==t.hide_emojos&&t.hide_emojos,this.MARKDOWN_BLOCKQUOTE=void 0!==t.markdown_blockquote&&t.markdown_blockquote,this.HIDE_COUNTER_BAR="undefined"!==t.hide_counter_bar&&t.hide_counter_bar,this.TEXT_MAX_LINES=t.text_max_lines||"0",this.LINK_SEE_MORE=t.link_see_more,this.FETCHED_DATA={},this.mtBodyContainer=document.getElementById(this.CONTAINER_BODY_ID),this.buildTimeline()};MastodonApi.prototype.buildTimeline=async function(){this.setTheme(),await this.getTimelineData(),this.mtBodyContainer.innerHTML="";for(let t in this.FETCHED_DATA.timeline)("public"==this.FETCHED_DATA.timeline[t].visibility||!this.HIDE_UNLISTED&&"unlisted"==this.FETCHED_DATA.timeline[t].visibility)&&(this.HIDE_REBLOG&&this.FETCHED_DATA.timeline[t].reblog||this.HIDE_REPLIES&&this.FETCHED_DATA.timeline[t].in_reply_to_id||this.appendToot(this.FETCHED_DATA.timeline[t],Number(t)));if(""===this.mtBodyContainer.innerHTML)this.mtBodyContainer.setAttribute("role","none"),this.mtBodyContainer.innerHTML='<div class="mt-error"><span class="mt-error-icon">üì≠</span><br/><strong>Sorry, no toots to show</strong><br/><div class="mt-error-message">Got '+this.FETCHED_DATA.timeline.length+" toots from the server. <br/>This may be due to an incorrect configuration in the parameters or to filters applied to hide certains type of toots.</div></div>";else{if(this.LINK_SEE_MORE){let t="";"profile"===this.TIMELINE_TYPE?t=this.PROFILE_NAME:"hashtag"===this.TIMELINE_TYPE?t="tags/"+this.HASHTAG_NAME:"local"===this.TIMELINE_TYPE&&(t="public/local");const e='<div class="mt-footer"><a href="'+this.INSTANCE_URL+"/"+this.escapeHtml(t)+'" target="_blank" rel="nofollow noopener noreferrer">'+this.LINK_SEE_MORE+"</a></div>";this.mtBodyContainer.parentNode.insertAdjacentHTML("beforeend",e)}this.manageSpinner()}this.mtBodyContainer.addEventListener("click",(function(o){"article"!=o.target.localName&&"article"!=o.target.offsetParent?.localName&&"img"!=o.target.localName||t(o),"button"==o.target.localName&&"spoiler-btn"==o.target.className&&e(o)})),this.mtBodyContainer.addEventListener("keydown",(function(e){"Enter"===e.key&&"article"==e.target.localName&&t(e)}));const t=function(t){const e=t.target.closest(".mt-toot").dataset.location;"a"!==t.target.localName&&"span"!==t.target.localName&&"button"!==t.target.localName&&"time"!==t.target.localName&&"mt-toot-preview-noImage"!==t.target.className&&"mt-toot-avatar-image-big"!==t.target.parentNode.className&&"mt-toot-avatar-image-small"!==t.target.parentNode.className&&"mt-toot-preview-image"!==t.target.parentNode.className&&"mt-toot-preview"!==t.target.parentNode.className&&e&&window.open(e,"_blank","noopener")},e=function(t){const e=t.target.nextSibling;"img"===e.localName?(t.target.parentNode.classList.remove("mt-toot-media-spoiler"),t.target.style.display="none"):(e.classList.contains("spoiler-text-hidden")||e.classList.contains("spoiler-text-visible"))&&("Show more"==t.target.textContent?(e.classList.remove("spoiler-text-hidden"),e.classList.add("spoiler-text-visible"),t.target.setAttribute("aria-expanded","true"),t.target.textContent="Show less"):(e.classList.remove("spoiler-text-visible"),e.classList.add("spoiler-text-hidden"),t.target.setAttribute("aria-expanded","false"),t.target.textContent="Show more"))}},MastodonApi.prototype.setTheme=function(){const t=function(t){document.documentElement.setAttribute("data-theme",t)};if("auto"===this.DEFAULT_THEME){let e=window.matchMedia("(prefers-color-scheme: dark)");e.matches?t("dark"):t("light"),e.addEventListener("change",(e=>{e.matches?t("dark"):t("light")}))}else t(this.DEFAULT_THEME)},MastodonApi.prototype.getTimelineData=async function(){return new Promise(((t,e)=>{let o={};"profile"===this.TIMELINE_TYPE?o.timeline=`${this.INSTANCE_URL}/api/v1/accounts/${this.USER_ID}/statuses?limit=${this.TOOTS_LIMIT}`:"hashtag"===this.TIMELINE_TYPE?o.timeline=`${this.INSTANCE_URL}/api/v1/timelines/tag/${this.HASHTAG_NAME}?limit=${this.TOOTS_LIMIT}`:"local"===this.TIMELINE_TYPE&&(o.timeline=`${this.INSTANCE_URL}/api/v1/timelines/public?local=true&limit=${this.TOOTS_LIMIT}`),this.HIDE_EMOJOS||(o.emojos=this.INSTANCE_URL+"/api/v1/custom_emojis");const i=Object.entries(o).map((([t,o])=>async function(t){const e=await fetch(t);if(!e.ok)throw new Error("Failed to fetch the following URL: "+t+"<hr>Error status: "+e.status+"<hr>Error message: "+e.statusText);return await e.json()}(o).then((e=>({[t]:e}))).catch((o=>(e(new Error("Something went wrong fetching data")),this.mtBodyContainer.innerHTML='<div class="mt-error"><span class="mt-error-icon">‚ùå</span><br/><strong>Sorry, request failed:</strong><br/><div class="mt-error-message">'+o.message+"</div></div>",this.mtBodyContainer.setAttribute("role","none"),{[t]:[]})))));Promise.all(i).then((e=>{this.FETCHED_DATA=e.reduce(((t,e)=>({...t,...e})),{}),t()}))}))},MastodonApi.prototype.appendToot=function(t,e){this.mtBodyContainer.insertAdjacentHTML("beforeend",this.assambleToot(t,e))},MastodonApi.prototype.assambleToot=function(t,e){let o,i,a,s,r,n,l,c,d;t.reblog?(s=t.reblog.url,o='<a href="'+t.reblog.account.url+'" class="mt-toot-avatar" rel="nofollow noopener noreferrer" target="_blank"><div class="mt-toot-avatar-boosted"><div class="mt-toot-avatar-image-big loading-spinner"><img src="'+t.reblog.account.avatar+'" alt="'+this.escapeHtml(t.reblog.account.username)+' avatar" loading="lazy" /></div><div class="mt-toot-avatar-image-small"><img src="'+t.account.avatar+'" alt="'+this.escapeHtml(t.account.username)+' avatar" loading="lazy" /></div></div></a>',a=this.showEmojos(t.reblog.account.display_name?t.reblog.account.display_name:t.reblog.account.username,this.FETCHED_DATA.emojos),i='<div class="mt-toot-header-user"><a href="'+t.reblog.account.url+'" rel="nofollow noopener noreferrer" target="_blank">'+a+'<span class="visually-hidden"> account</span></a></div>',r=t.reblog.created_at,d=t.reblog.replies_count,c=t.reblog.reblogs_count,l=t.reblog.favourites_count):(s=t.url,o='<a href="'+t.account.url+'" class="mt-toot-avatar" rel="nofollow noopener noreferrer" target="_blank"><div class="mt-toot-avatar-standard"><div class="mt-toot-avatar-image-big loading-spinner"><img src="'+t.account.avatar+'" alt="'+this.escapeHtml(t.account.username)+' avatar" loading="lazy" /></div></div></a>',a=this.showEmojos(t.account.display_name?t.account.display_name:t.account.username,this.FETCHED_DATA.emojos),i='<div class="mt-toot-header-user"><a href="'+t.account.url+'" rel="nofollow noopener noreferrer" target="_blank">'+a+'<span class="visually-hidden"> account</span></a></div>',r=t.created_at,d=t.replies_count,c=t.reblogs_count,l=t.favourites_count),n=this.formatDate(r);const m='<div class="mt-toot-header-date"><a href="'+s+'" rel="nofollow noopener noreferrer" target="_blank"><time datetime="'+r+'">'+n+"</time></a></div>";let h="";"0"!==this.TEXT_MAX_LINES&&(h="truncate",document.documentElement.style.setProperty("--text-max-lines",this.TEXT_MAX_LINES));let p="";p=""!==t.spoiler_text?'<div class="mt-toot-text">'+t.spoiler_text+' <button type="button" class="spoiler-btn" aria-expanded="false">Show more</button><div class="spoiler-text-hidden">'+this.formatTootText(t.content)+"</div></div>":t.reblog&&""!==t.reblog.content&&""!==t.reblog.spoiler_text?'<div class="mt-toot-text">'+t.reblog.spoiler_text+' <button type="button" class="spoiler-btn" aria-expanded="false">Show more</button><div class="spoiler-text-hidden">'+this.formatTootText(t.reblog.content)+"</div></div>":t.reblog&&""!==t.reblog.content&&""===t.reblog.spoiler_text?'<div class="mt-toot-text'+h+'"><div class="mt-toot-text-wrapper">'+this.formatTootText(t.reblog.content)+"</div></div>":'<div class="mt-toot-text'+h+'"><div class="mt-toot-text-wrapper">'+this.formatTootText(t.content)+"</div></div>";let g=[];if(t.media_attachments.length>0)for(let e in t.media_attachments)g.push(this.placeMedias(t.media_attachments[e],t.sensitive));if(t.reblog&&t.reblog.media_attachments.length>0)for(let e in t.reblog.media_attachments)g.push(this.placeMedias(t.reblog.media_attachments[e],t.reblog.sensitive));let u="";!this.HIDE_PREVIEW_LINK&&t.card&&(u=this.placePreviewLink(t.card));let _="";if(t.poll){let e="";for(let o in t.poll.options)e+="<li>"+t.poll.options[o].title+"</li>";_='<div class="mt-toot-poll '+(t.poll.expired?"mt-toot-poll-expired":"")+'"><ul>'+e+"</ul></div>"}let v="";if(!this.HIDE_COUNTER_BAR){v='<div class="mt-toot-counter-bar">'+('<div class="mt-toot-counter-bar-replies"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 -960 960 960" aria-hidden="true"><path d="M774.913-185.869V-356q0-56.609-35.891-92.5-35.892-35.891-92.5-35.891H258.045L411.435-331l-56 56.566L105.869-524l249.566-249.566 56 56.566-153.39 153.391h388.477q88.957 0 148.566 59.609 59.608 59.609 59.608 148v170.131h-79.783Z"></path></svg>'+d+"</div>")+('<div class="mt-toot-counter-bar-reblog"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 -960 960 960" aria-hidden="true"><path d="M276.043-65.304 105.869-236.043l170.174-170.175 52.74 54.175-78.652 78.652h449.304v-160h75.261v235.261H250.131l78.652 78.087-52.74 54.74Zm-90.174-457.348v-235.261h524.565L631.782-836l52.74-54.74L854.696-720 684.522-549.26 631.782-604l78.652-78.652H261.13v160h-75.261Z"></path></svg>'+c+"</div>")+('<div class="mt-toot-counter-bar-favorites"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 -960 960 960" aria-hidden="true"><path d="m330.955-216.328 149.066-89 149.066 90.023-40.305-168.391 131.217-114.347-172.956-14.87L480-671.869l-67.043 158.521-172.956 14.305 131.427 113.796-40.473 168.919ZM212.086-50.608l70.652-305.305L45.52-561.305l312.645-26.579L480-876.176l121.835 288.292 312.645 26.579-237.218 205.392 71.217 305.306L480-213.173 212.086-50.607ZM480-433.87Z"></path></svg>'+l+"</div>")+"</div>"}return'<article class="mt-toot" aria-posinset="'+(e+1)+'" aria-setsize="'+this.TOOTS_LIMIT+'" data-location="'+s+'" tabindex="0"><div class="mt-toot-header">'+o+i+m+"</div>"+p+g.join("")+u+_+v+"</article>"},MastodonApi.prototype.formatTootText=function(t){let e=t;return e=this.addTarget2hashtagMention(e),this.HIDE_EMOJOS||(e=this.showEmojos(e,this.FETCHED_DATA.emojos)),this.MARKDOWN_BLOCKQUOTE&&(e=this.replaceHTMLtag(e,"<p>&gt;","</p>","<blockquote><p>","</p></blockquote>")),e},MastodonApi.prototype.addTarget2hashtagMention=function(t){let e=t.replaceAll('rel="tag"','rel="tag" target="_blank"');return e=e.replaceAll('class="u-url mention"','class="u-url mention" target="_blank"'),e},MastodonApi.prototype.showEmojos=function(t,e){if(t.includes(":")){for(const o of e){const e=new RegExp(`\\:${o.shortcode}\\:`,"g");t=t.replace(e,`<img src="${o.url}" class="custom-emoji" alt="Emoji ${o.shortcode}" />`)}return t}return t},MastodonApi.prototype.replaceHTMLtag=function(t,e,o,i,a){if(t.includes(e)){const s=new RegExp(e+"(.*?)"+o,"gi");return t.replace(s,i+"$1"+a)}return t},MastodonApi.prototype.placeMedias=function(t,e){const o=e||!1;return'<div class="mt-toot-media img-ratio14_7 '+(o?"mt-toot-media-spoiler ":"")+this.SPINNER_CLASS+'">'+(o?'<button class="spoiler-btn">Show content</button>':"")+'<img src="'+t.preview_url+'" alt="'+(t.description?this.escapeHtml(t.description):"")+'" loading="lazy" /></div>'},MastodonApi.prototype.placePreviewLink=function(t){return'<a href="'+t.url+'" class="mt-toot-preview" target="_blank" rel="noopener noreferrer">'+(t.image?'<div class="mt-toot-preview-image '+this.SPINNER_CLASS+'"><img src="'+t.image+'" alt="'+this.escapeHtml(t.image_description)+'" loading="lazy" /></div>':'<div class="mt-toot-preview-noImage">üìÑ</div>')+'</div><div class="mt-toot-preview-content">'+(t.provider_name?'<span class="mt-toot-preview-provider">'+this.parseHTMLstring(t.provider_name)+"</span>":"")+'<span class="mt-toot-preview-title">'+t.title+"</span>"+(t.author_name?'<span class="mt-toot-preview-author">'+this.parseHTMLstring(t.author_name)+"</span>":"")+"</div></a>"},MastodonApi.prototype.formatDate=function(t){const e=new Date(t);return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()},MastodonApi.prototype.parseHTMLstring=function(t){return(new DOMParser).parseFromString(t,"text/html").body.textContent},MastodonApi.prototype.escapeHtml=function(t){return(t??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")},MastodonApi.prototype.manageSpinner=function(){const t=this.SPINNER_CLASS,e=function(){this.parentNode.classList.remove(t),this.removeEventListener("load",e),this.removeEventListener("error",e)};this.mtBodyContainer.querySelectorAll(`.${this.SPINNER_CLASS} > img`).forEach((t=>{t.addEventListener("load",e),t.addEventListener("error",e)}))};