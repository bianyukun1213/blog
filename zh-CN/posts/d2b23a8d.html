<!DOCTYPE html><html lang="zh-CN" dir="ltr"><head><meta name="fediverse:creator" content="@Hollis@m.cmx.im"><link rel="stylesheet" href="/shared/third-party/hexo-tag-plugins/tag-image-masonry.css"><link rel="stylesheet" href="/shared/third-party/hexo-tag-plugins/tag-alertbox.css"><link rel="stylesheet" href="/shared/custom.css"><link rel="stylesheet" href="/zh-CN/css/third-party/modern-normalize.min.css"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Unraid OS 踩坑记录</title><meta name="keywords" content="Unraid OS 配置,Unraid 配置,Unraid OS 踩坑,Unraid 踩坑"><meta name="description" content="本文记录了个人 NAS 上的 Unraid OS 的配置内容，包括系统设置、Docker 设置、虚拟机设置、VPN 设置等，还包含一些注意事项。"><meta property="og:type" content="article"><meta property="og:title" content="Unraid OS 踩坑记录"><meta property="og:url" content="https://his2nd.life/zh-CN/posts/d2b23a8d.html"><meta property="og:site_name" content="他的第二人生"><meta property="og:description" content="本文记录了个人 NAS 上的 Unraid OS 的配置内容，包括系统设置、Docker 设置、虚拟机设置、VPN 设置等，还包含一些注意事项。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2023-05-20T06:12:36.000Z"><meta property="article:modified_time" content="2025-02-14T13:26:46.000Z"><meta property="article:author" content="Hollis"><meta property="article:tag" content="GNU&#x2F;Linux"><meta property="article:tag" content="NAS"><meta property="article:tag" content="Unraid OS"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://his2nd.life/zh-CN/posts/d2b23a8d.html"><meta name="robots" content="all"><link rel="alternate" href="/zh-CN/atom.xml" title="他的第二人生" type="application/atom+xml"><link rel="icon" href="https://bucket.hollisdevhub.com/blog/common/favicon-32.webp"><link rel="me" href="mailto:bianyukun1213@outlook.com"><link rel="me" href="https://yukun.bio/"><link rel="me" href="https://github.com/bianyukun1213"><link rel="me" href="https://m.cmx.im/@Hollis"><link rel="authorization_endpoint" href="https://indieauth.com/auth"><link rel="webmention" href="https://webmention.io/his2nd.life/webmention"><link rel="preconnect" href="https://fonts.googleapis.cn"><link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin="anonymous"><link rel="stylesheet" href="https://fonts.googleapis.cn/css2?family=Noto+Sans+SC:wght@100..900&family=Noto+Serif+SC:wght@200..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.cn/css2?family=Ma+Shan+Zheng&&text=%E4%BA%BA%E7%94%9F%E8%8B%A6%E7%9F%AD%EF%BC%8C%E6%88%91%E8%A6%81%E6%B4%BB%E5%87%BA%E5%8F%8C%E5%80%8D%E7%B2%BE%E5%BD%A9%EF%BC%81&display=swap"><meta name="generator" content="Hexo 7.3.0"><meta name="generator" content="hexo-theme-tide 1.0.0"><meta name="tide-client-ctx" content="%7B%22progress_marker%22%3A%22%2F%22%2C%22search_db_path%22%3A%22%2Fzh-CN%2Fsearch.json%22%2C%22interactions%22%3A%7B%22twikoo%22%3A%7B%22env_id%22%3A%22https%3A%2F%2Ftwikoo.his2nd.life%22%2C%22region%22%3A%22%22%7D%2C%22webmentionjs%22%3A%7B%22wordcount%22%3A-1%2C%22max_webmentions%22%3A30%2C%22prevent_spoofing%22%3Afalse%2C%22sort_by%22%3A%22published%22%2C%22sort_dir%22%3A%22up%22%2C%22comments_are_reactions%22%3Afalse%2C%22i18n%22%3A%7B%22replied%22%3A%22%E5%9B%9E%E5%A4%8D%E4%BA%86%22%2C%22liked%22%3A%22%E5%96%9C%E6%AC%A2%E4%BA%86%22%2C%22reposted%22%3A%22%E8%BD%AC%E5%8F%91%E4%BA%86%22%2C%22reacted%22%3A%22%E5%8F%8D%E5%BA%94%E4%BA%86%22%2C%22bookmarked%22%3A%22%E5%8A%A0%E5%85%A5%E4%BA%86%E4%B9%A6%E7%AD%BE%22%2C%22mentioned%22%3A%22%E6%8F%90%E5%8F%8A%E4%BA%86%22%2C%22RSVPed%22%3A%22%E5%93%8D%E5%BA%94%E4%BA%86%E4%BA%8B%E4%BB%B6%22%2C%22followed%22%3A%22%E5%85%B3%E6%B3%A8%E4%BA%86%22%2C%22Responses%22%3A%22%E5%9B%9E%E5%BA%94%22%2C%22mention%22%3A%22%E6%8F%90%E5%8F%8A%22%2C%22Reactions%22%3A%22%E5%8F%8D%E5%BA%94%22%7D%7D%7D%7D"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U&#x2F;M7pSPA&#x2F;gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg&#x3D;&#x3D;" crossorigin="anonymous" referrerpolicy="no-referrer"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" integrity="sha512-vswe+cgvic&#x2F;XBoF1OcM&#x2F;TeJ2FW0OofqAVdCZiEYkd6dwGXthvkSFWOoGGJgS2CW70VK5dQM5Oh+7ne47s74VTg&#x3D;&#x3D;" crossorigin="anonymous" referrerpolicy="no-referrer"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" integrity="sha512-cbQXwDFK7lj2Fqfkuxbo5iD1dSbLlJGXGpfTDqbggqjHJeyzx88I3rfwjS38WJag&#x2F;ihH7lzuGlGHpDBymLirZQ&#x3D;&#x3D;" crossorigin="anonymous" referrerpolicy="no-referrer"><link rel="stylesheet" href="/zh-CN/css/tide.css"><script src="/zh-CN/js/client-utils.js"></script><script src="/zh-CN/js/tide.js"></script><link rel="stylesheet" href="/zh-CN/css/collapse.css"></head><body class="un-text-base un-text-txt-prim un-break-words"><script src="https://s4.zstatic.net/ajax/libs/macy/2.5.1/macy.min.js" integrity="sha512-/o/3HSUNsIEsxRpMb5LdGO+algy6JHTf3tMn2VpWKfVexrEAepEzsuJPA51tJVdC9kCHsN5+Z4GJ35pcldgsGw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><div id="tide-root" class="un-bg-b-scnd un-absolute un-size-full un-text-base" tide-is-post="true"><div id="tide-sidebar" class="un-sc-trans-default un-bg-bg-sb un-fixed un-h-full un-flex un-flex-col un-justify-between un-z-30 un-text-center un-text-txt-sb"><header class="un-flex-none un-p-8"><p id="tide-site-title" class="un-m-0 un-my-4 un-font-bold">他的第二人生</p><p id="tide-site-subtitle" class="un-m-0 un-my-2 un-font-italic">人生苦短，我要活出双倍精彩！</p></header><div class="h-card un-hidden"><span class="p-honorific-prefix"></span> <span class="p-name">边宇琨</span> <span class="p-given-name">宇琨</span> <span class="p-additional-name"></span> <span class="p-family-name">边</span> <span class="p-honorific-suffix"></span> <span class="p-nickname">Hollis</span> <img class="u-photo" src="https://bucket.hollisdevhub.com/blog/common/avatar.webp" alt="边宇琨" loading="lazy"> <a class="u-url u-uid" target="_blank" rel="noopener" href="https://yukun.bio/">yukun.bio</a><a class="u-url u-uid" href="https://his2nd.life/">他的第二人生</a><a class="u-url u-uid" target="_blank" rel="noopener" href="https://m.cmx.im/@Hollis">Mastodon</a><a class="u-url u-uid" target="_blank" rel="noopener" href="https://github.com/bianyukun1213">GitHub</a><a class="u-email" href="mailto:bianyukun1213@outlook.com">bianyukun1213@outlook.com</a><div class="p-note">Just a **S**illy **B**oy.</div></div><nav id="tide-navigation" class="un-w-full un-flex-initial un-self-center"><ul class="un-w-auto un-inline-flex un-flex-col un-items-start un-p-0 un-m-0 un-list-none"><li class="un-inline-block un-mb-8"><i class="fa-solid fa-house un-me-4" aria-hidden="true"></i><a class="un-sc-link-plain un-text-txt-sb!" href="/zh-CN/">首页</a></li><li class="un-inline-block un-mb-8"><i class="fa-solid fa-folder-open un-me-4" aria-hidden="true"></i><a class="un-sc-link-plain un-text-txt-sb!" href="/zh-CN/categories/">分类</a></li><li class="un-inline-block un-mb-8"><i class="fa-solid fa-tag un-me-4" aria-hidden="true"></i><a class="un-sc-link-plain un-text-txt-sb!" href="/zh-CN/tags/">标签</a></li><li class="un-inline-block un-mb-8"><i class="fa-solid fa-hand-pointer un-me-4" aria-hidden="true"></i><a class="un-sc-link-plain un-text-txt-sb!" href="/zh-CN/neighbors/">网上邻居</a></li><li class="un-inline-block un-mb-8"><i class="fa-solid fa-circle-info un-me-4" aria-hidden="true"></i><a class="un-sc-link-plain un-text-txt-sb!" href="/zh-CN/about/">关于</a></li><li class="un-inline-block un-mb-8"><i class="fa-solid fa-rss un-me-4" aria-hidden="true"></i><a class="un-sc-link-plain un-text-txt-sb!" href="/zh-CN/atom.xml" target="_blank">RSS</a></li></ul></nav><footer class="un-flex-none un-p-8"><a id="travelling-link" href="https://www.travellings.cn/plain.html" target="_self" rel="noopener" title="开往-友链接力"><img id="travelling-logo" src="https://www.travellings.cn/assets/logo.svg" alt="开往-友链接力" loading="lazy"></a><div class="un-m-0 un-my-4 un-text-txt-sb" dir="ltr"><a class="un-sc-link-plain un-text-txt-sb!" href="https://xn--sr8hvo.ws/previous" target="_self" rel="noopener">←</a> An <a class="un-sc-link-plain un-text-txt-sb!" href="https://xn--sr8hvo.ws" target="_blank" rel="noopener">IndieWeb Webring</a> 🕸💍 <a class="un-sc-link-plain un-text-txt-sb!" href="https://xn--sr8hvo.ws/next" target="_self" rel="noopener">→</a></div><p id="tide-icp-record" class="un-m-0 un-my-4"><a class="un-sc-link-plain un-text-txt-sb!" target="_blank" rel="noopener" href="https://icp.gov.moe/?keyword=20230041">萌ICP备20230041号</a></p><p id="tide-generated-by-hexo-and-theme-tide" class="un-m-0 un-my-4">使用<span class="un-i-logos-hexo un-mx-1"></span><a class="un-sc-link-plain un-text-txt-sb!" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> 与 <a class="un-sc-link-plain un-text-txt-sb!" href="https://github.com/bianyukun1213/hexo-theme-tide" target="_blank" rel="noopener">hexo-theme-tide</a> 生成</p></footer></div><div id="tide-content" class="un-sc-trans-default un-fixed un-size-full un-flex un-flex-col"><header id="tide-top-bar" class="un-bg-bg-prim un-h-16 un-flex un-justify-stretch un-items-center un-overflow-auto"><div class="un-w-1/4 un-min-w-18 un-h-12"><button id="tide-btn-nav" class="un-sc-btn-default un-relative un-float-start un-size-12 un-ms-4" title="打开或关闭导航菜单"><i id="tide-btn-nav-icon-bars" class="fa-solid fa-bars" aria-hidden="true"></i><i id="tide-btn-nav-icon-close" class="fa-solid fa-close" aria-hidden="true"></i></button></div><div class="un-w-3/4 un-min-w-30 un-h-12"><button id="tide-btn-search" class="un-sc-btn-default un-relative un-float-end un-end-14 un-size-12 un-me-4" title="打开搜索窗口"><i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i></button> <button id="tide-btn-switch-color-scheme" class="un-sc-btn-default un-relative un-float-end -un-end-16 un-size-12 un-me-4" title="切换到浅色或深色显示"><i id="tide-btn-nav-icon-sun" class="fa-solid fa-sun" aria-hidden="true"></i><i id="tide-btn-nav-icon-moon" class="fa-solid fa-moon" aria-hidden="true"></i></button> <button id="tide-btn-settings" class="un-hidden un-sc-btn-default un-relative un-float-end -un-end-16 un-size-12 un-me-4" title="打开设置窗口"><i class="fa-solid fa-gear" aria-hidden="true"></i></button></div></header><main id="tide-main-content" class="un-bg-bg-prim un-flex-1 un-overflow-auto"><article id="tide-post" class="h-entry"><h1 id="tide-page-title" class="p-name un-m-0 un-mb-2 un-text-4xl un-text-txt-prim un-font-bold">Unraid OS 踩坑记录</h1><div class="tide-post-meta un-mb-4 un-text-txt-scnd"><span class="tide-post-meta-author un-inline-block un-me-8" title="作者"><i class="fa-solid fa-user un-me-1" aria-hidden="true"></i>Hollis </span><span class="tide-post-meta-date un-inline-block un-me-8" title="发表时间"><i class="fa-solid fa-pen un-me-1" aria-hidden="true"></i><time datetime="2023-05-20T06:12:36.000Z">2023-05-20 14:12:36</time> </span><span class="tide-post-meta-updated un-inline-block un-me-8" title="更新时间"><i class="fa-solid fa-wrench un-me-1" aria-hidden="true"></i><time datetime="2025-02-14T13:26:46.000Z">2025-02-14 21:26:46</time> </span><span class="tide-post-meta-categories un-inline-block un-me-8" title="分类"><i class="fa-solid fa-folder-open un-me-1" aria-hidden="true"></i><a class="un-sc-link-plain un-text-txt-scnd!" href="/zh-CN/categories/technologies-and-studies/">技术与研究</a> </span><span class="tide-post-meta-tags un-inline-block un-me-8" title="Tags"><i class="fa-solid fa-tag un-me-1" aria-hidden="true"></i><a class="un-sc-link-plain un-text-txt-scnd!" href="/zh-CN/tags/gnu-linux/">GNU/Linux</a>，<a class="un-sc-link-plain un-text-txt-scnd!" href="/zh-CN/tags/nas/">NAS</a>，<a class="un-sc-link-plain un-text-txt-scnd!" href="/zh-CN/tags/unraid-os/">Unraid OS</a> </span><span class="tide-post-meta-word-count un-inline-block un-me-8" title="字数"><i class="fa-solid fa-keyboard un-me-1" aria-hidden="true"></i>4.9k </span><span class="tide-post-meta-reading-time un-inline-block un-me-8" title="预计阅读时间"><i class="fa-solid fa-clock un-me-1" aria-hidden="true"></i>18 mins. </span><span class="tide-post-meta-extra un-inline-block un-me-8" title="版权声明"><i class="fa-solid fa-copyright un-me-1" aria-hidden="true"></i>CC-BY-SA 4.0 </span><span class="tide-post-meta-extra un-inline-block un-me-8" title="描述"><i class="fa-solid fa-comment-dots un-me-1" aria-hidden="true"></i>本文记录了个人 NAS 上的 Unraid OS 的配置内容，包括系统设置、Docker 设置、虚拟机设置、VPN 设置等，还包含一些注意事项。</span></div><div class="tide-hidden-microformats2-group un-hidden"><a class="u-url un-hidden" href="https://his2nd.life/zh-CN/posts/d2b23a8d.html">https://his2nd.life/zh-CN/posts/d2b23a8d.html</a><p class="p-summary un-hidden">五一的时候把家中自组的 NAS 从 Windows 10 系统换到了 Unraid OS，在此记录一下配置与注意事项，以便之后重装有得参考。</p><div class="h-card p-author un-hidden"><span class="p-honorific-prefix"></span> <span class="p-name">边宇琨</span> <span class="p-given-name">宇琨</span> <span class="p-additional-name"></span> <span class="p-family-name">边</span> <span class="p-honorific-suffix"></span> <span class="p-nickname">Hollis</span> <img class="u-photo" src="https://bucket.hollisdevhub.com/blog/common/avatar.webp" alt="边宇琨" loading="lazy"> <a class="u-url u-uid" target="_blank" rel="noopener" href="https://yukun.bio/">yukun.bio</a><a class="u-url u-uid" href="https://his2nd.life/">他的第二人生</a><a class="u-url u-uid" target="_blank" rel="noopener" href="https://m.cmx.im/@Hollis">Mastodon</a><a class="u-url u-uid" target="_blank" rel="noopener" href="https://github.com/bianyukun1213">GitHub</a><a class="u-email" href="mailto:bianyukun1213@outlook.com">bianyukun1213@outlook.com</a><div class="p-note">Just a **S**illy **B**oy.</div></div><time class="dt-published un-hidden" datetime="2023-05-20T06:12:36.000Z">2023-05-20T06:12:36.000Z</time> <time class="dt-updated un-hidden" datetime="2025-02-14T13:26:46.000Z">2025-02-14T13:26:46.000Z</time> <a class="p-category un-hidden" href="https://his2nd.life/zh-CN/categories/technologies-and-studies/">技术与研究</a></div><div class="e-content un-prose un-max-w-none"><p>五一的时候把家中自组的 NAS 从 Windows 10 系统换到了 Unraid OS，在此记录一下配置与注意事项，以便之后重装有得参考。</p><span id="more"></span><hr><h2 id="Unraid-OS-注意事项">Unraid OS 注意事项</h2><p class="h2l-text-indent">原先在 Windows 下使用的 USB 有线网卡在 Unraid OS 下有点儿毛病，时间长了会使机器失联，而板载网卡在 Windows 下都有毛病，所以我装了闲置的 TP-Link 牌的 PCI-E 网卡，芯片是 <code>RTL8111/8168/8411</code> 三个型号之一，目前用着还正常；Unraid OS 支持的网卡参考<a target="_blank" rel="noopener" href="https://wiki.unraid.net/Hardware_Compatibility#Network_Controllers">“Hardware Compatibility”</a>，据说英特尔的兼容性很好。</p><p class="h2l-text-indent">关机或重启前<strong>手动停止阵列</strong>，停止阵列之前先手动停止所有容器更好，此外，大折腾前先<strong>备份一遍 CA 和虚拟机</strong>，这都是<strong>教训</strong>！Unraid OS 的关机和重启似乎不是那么可靠，有时候是强制的，导致缓存池文件系统报错，<strong>无法修复</strong>，只能恢复备份，<strong>妈了个逼的好几次了</strong>！（也许是我使用 Dynamix System Buttons 导致的？总之还是先手动停止阵列保险一些。）</p><p class="h2l-text-indent">另外，在 <code>go</code> 文件内写入 Docker 镜像加速地址：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 国内 Docker 镜像加速</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/docker
<span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'
&#123;
    "registry-mirrors": ["&lt;注册表地址>"]
&#125;
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p class="h2l-text-indent">有时，比如未停止阵列就重启后，会遇到类似 <code>BTRFS warning (device sde1): csum failed root 5 ino 42260 off 57344 csum 0xdbb001ce expected csum 0x20d7987a mirror 1</code> 的错误。需要用 <code>sudo btrfs inspect-internal inode-resolve 42260 /mnt/cache/</code> （<code>/mnt/cache</code> 是 <code>sde1</code> 的挂载点。）找出 inode 为 <code>42260</code> 的文件并删除。当主机意外断电，我就很容易在 Uptime Kuma 的数据库文件 <code>kuma.db</code> 上遇到这样的错误。然而，其实在停止阵列并手动重启时我也遇到过这样的错误……我使用命令 <code>btrfs dev stats -c /mnt/cache</code> 来监测 BTRFS 错误，在删除了对应文件，srub 操作不报错后使用 <code>btrfs dev stats -z /mnt/cache</code> 清除错误技术。</p><p class="h2l-text-indent">有时还会遇到这样的错误：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">Jan 14 10:25:32 HollisNAS kernel: BTRFS error (device sde1): unable to fixup (regular) error at logical 4147904512 on dev /dev/sde1 physical 5230034944
Jan 14 10:25:32 HollisNAS kernel: BTRFS warning (device sde1): checksum error at logical 4147904512 on dev /dev/sde1, physical 5230034944, root 5, inode 2216019, offset 4415488, length 4096, links 1 (path: appdata/MoviePilot_v2/config/logs/moviepilot.log)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>如果没有显示文件路径，可以通过 <code>btrfs inspect-internal logical-resolve 4147904512 /mnt/cache</code> 查找。</p><p class="h2l-text-indent">我还曾遇到一种错误，不能通过删除某一个文件解决，只能重新建立文件系统。等我下次再遇到了，把错误写在这里。</p><h3 id="设置">设置</h3><p class="h2l-text-indent">在 <code>设置 &gt; Docker</code> 页面删除镜像前，<strong>先备份 appdata</strong>！</p><ul><li>路由器映射总端口~~、WireGuard 端口，IPv6 的 DNS 设为无效地址 <code>2000::1</code>、<code>2000::2</code>，让路由器为 IPv6 使用 IPv4 DNS~~。不再使用 AdGuardHome。WireGuard 改为放在路由器上。</li><li>默认休眠延迟 1 小时。</li><li>虚拟机关机超时 300 秒，磁盘关机超时 420 秒。</li><li>在 <code>可调式 (md_write_method)</code> 开启重建写入（Turbo Write），见<a target="_blank" rel="noopener" href="https://forums.unraid.net/topic/50397-turbo-write/">“Turbo write”</a>，缺点是写入时阵列内全部磁盘都将唤醒。</li><li>启用 SMB 多通道。</li><li>阿里云 NTP 服务器。</li><li>启用 IPv6。</li><li>为 Docker 启用 <code>主机访问自定义网络</code>。</li><li><s>关闭磁盘共享，仅使用用户共享（磁盘共享与用户共享互拷文件，且位于同一磁盘时会出问题，关闭磁盘共享能减少人为犯错可能）：</s><ul><li>总开关开着了，有时候需要使用磁盘共享，就单独给某块磁盘开启共享。</li></ul></li><li>6.12 新增的独占模式保持关闭——虽然独占模式绕过了基于 FUSE 的 SHFS，能提高共享目录读写性能，但 AList 和荒野无灯的 File Browser 还不能识别符号链接形式的目录。</li><li>启用本地系统日志服务器，并且远程系统日志服务器地址填本机地址（192.168 的）。</li><li>WireGuard 设置远程隧道访问。</li><li>Docker 虚拟磁盘大小设为 30 GB。</li><li>各种更新通知设为每周检查一次，但在下方关闭插件与 Docker 更新通知。</li><li>为通知配置 ServerChan 代理，为 Warnings 和 Alerts 勾选通知代理。</li><li>自动奇偶校验每月 7 日 3 点。</li><li>Mover 设为每日 7 点。</li><li>SSD Trim 每周四 2 点。</li><li>……</li></ul><h3 id="阵列与池">阵列与池</h3><p class="h2l-text-indent">阵列使用 XFS，自身不支持静默数据损坏检查，数据由校验盘保护，基于 FUSE 的 SHFS 以目录为单位将文件拆分到阵列内的多块硬盘上，若无校验盘保护，一块硬盘损坏，其他硬盘上的文件仍可读取。</p><p class="h2l-text-indent">池使用 Btrfs，支持静默数据损坏检查，数据由 RAID 保护，文件在池内的分布由 RAID 级别决定，若无 RAID 保护，一块硬盘损坏，其他硬盘上的文件无法读取（RAID 0）或修复后仅可读取部分（single，见<a target="_blank" rel="noopener" href="https://serverfault.com/questions/890547/btrfs-single-data-fs-still-striped">“BTRFS single data FS still striped?”</a>）。</p><p class="h2l-text-indent">Unraid OS 6.12 新增 ZFS 支持，折腾了一番还是换回了 Btrfs。ZFS <a target="_blank" rel="noopener" href="https://www.v2ex.com/t/738276">磁盘阵列扩展无法加盘</a>，且<a target="_blank" rel="noopener" href="https://www.reddit.com/r/zfs/comments/muwr1a/best_practice_for_changing_raid0_pool_to_raidz/">切换 Profile 需要整体重建</a>。Btrfs 的 RAID5/6 还不稳定，不建议使用，但至少容易扩展。</p><p class="h2l-text-indent">有时候因为折腾，<code>docker.img</code> 被存放在阵列中，因持续占用无法触发 Mover 移动回 Cache，无法使阵列休眠。所以我干脆将各共享的副存储全部禁用了，见下文“共享”部分。</p><ul><li>1 TB 硬盘放入阵列。</li><li>4 TB 硬盘作为校验盘。</li><li>SSD 作为 Cache。</li><li>18 TB 硬盘作为 Pool，single，Balance Schedule <s>设为每月 25 日 4 点</s>关闭。</li><li>……</li></ul><h3 id="共享">共享</h3><ul><li>appdata，application data，存在 Cache（系统默认是辅阵列 -&gt; 主 Cache），私有共享，最小可用空间 200 MB。</li><li>dnml，下载与媒体库，存在 Pool，私有共享，最小可用空间 60 GB。</li><li>domains，saved VM instances，存在 Cache（系统默认是辅阵列 -&gt; 主 Cache），私有共享，最小可用空间 80 GB。</li><li>gallery，相册，存在阵列，私有共享，最小可用空间 50 MB。</li><li>isos，ISO images，存在阵列（系统默认是主 Cache -&gt; 辅阵列），私有共享，最小可用空间 10 GB。</li><li>large_data，不重要的大型数据，存在 Pool，私有共享，最小可用空间 10 GB。</li><li>large_temp，不重要的大型临时数据，存在 Cache，私有共享，最小可用空间 10 GB。</li><li>local_backups，CA 与 VM 备份，存在阵列，私有共享，最小可用空间 80 GB。</li><li>syslog，系统日志，存在 Cache，私有共享，最小可用空间 30 MB。</li><li>system，system data，存在 Cache（系统默认是辅阵列 -&gt; 主 Cache），私有共享，最小可用空间 30 GB。</li><li>user_guest，宾客文件，存在阵列，公开共享，最小可用空间 10 GB。</li><li>user_hollis，Hollis 文件，存在阵列，私有共享，最小可用空间 30 GB。</li><li>……</li></ul><h3 id="插件">插件</h3><ul><li>Community Applications，必装。</li><li>已卸载：Unraid Connect，用于远程管理机器，对我来说没啥用。</li><li>Fix Common Problems，问题检测。</li><li><s>Proxy Editor，快捷编辑代理，让容器镜像更新检查和 CA 安装走代理，需要手动安装，这是<a target="_blank" rel="noopener" href="https://forums.unraid.net/topic/132645-proxy-editor-%E6%8F%90%E4%BE%9B%E5%8F%AF%E8%A7%86%E5%8C%96%E9%A1%B5%E9%9D%A2%EF%BC%8C%E6%96%B9%E4%BE%BF%E5%BF%AB%E6%8D%B7%E8%AE%BE%E7%BD%AE%E3%80%81%E5%88%87%E6%8D%A2%E4%BB%A3%E7%90%86/">支持链接</a>。</s></li><li>已卸载：Unassigned Devices 和 Unassigned Devices Plus，挂载未分配给阵列和池的磁盘，我为此插件添加了中文翻译。</li><li>CA Auto Update Applications，自动更新 CA 和容器镜像，我设置的是每周一 2 点更新 CA，5 点更新容器镜像，排除了 AList、mihomo、DDNS、filebrowser、Transmission、nginxWebUI、qBittorrent、MoviePilot、code-server、Duplicati、Krusader，均关闭更新通知。</li><li>Backup/Restore Appdata（安装名称：Appdata Backup），定时备份 CA 配置，我设置的是每周二 2 点，备份 Flash，不备份 VM 元数据，VM 由另一个插件备份：<ul><li>为 Stash 启用外部卷备份，设置排除列表，只备份内部卷和存储媒体元数据的目录。</li></ul></li><li>VM Backup，定时备份虚拟机，每周五 10 点，启用 Zstandard 压缩（恢复时可用 <code>zstd -d</code> 解压），仅开启错误通知：<ul><li>目前这个插件在系统重启后会自动下载一些文件，如果下载不成功，就会变成卸载状态，临时的解决方案见<a target="_blank" rel="noopener" href="https://forums.unraid.net/topic/86303-vm-backup-plugin/?do=findComment&amp;comment=1291834">此贴</a>，他楼上那个 HeyHollis 就是我，哈哈。</li></ul></li><li>User Scripts，运行自定义脚本。</li><li>Dynamix File Integrity，定期检查静默数据损坏，每周三 2 点，关闭通知，我为此插件添加了中文翻译。</li><li><s>Dynamix File Manager，简易文件管理器</s> Unraid 7.0 内置。</li><li>Dynamix System Autofan，自动控制风扇转速：<ul><li>需要注意的是，系统缺少“ITE IT8613E Super IO Sensors”驱动程序，需要在 <code>go</code> 文件中添加 <code>modprobe it87 force_id=0x8620</code> 才能正常使用此插件，见<a target="_blank" rel="noopener" href="https://forums.unraid.net/topic/111683-no-fan-control/">“No fan control?”</a>。</li><li>此插件只管理系统风扇，我使用利民的风扇集线器来扩展风扇接口，CPU 风扇仍然接在 CPU 风扇接口上，系统风扇接在集线器上。</li><li>预先在 BIOS 中将系统风扇调到 <code>无声</code> 挡（<code>正常</code> 挡太吵了），CPU 风扇使用 <code>正常</code> 挡即可。</li><li>我为此插件添加了中文翻译。</li></ul></li><li>Dynamix System Temperature，显示系统温度：<ul><li>在解决了 Dynamix System Autofan 的问题后，可选 <code>it8620</code> 作为阵列温度显示。</li><li>还需添加 <code>modprobe coretemp</code> 和 <code>/usr/bin/sensors -s</code>。</li></ul></li><li>GPU Statistics，在仪表板显示 GPU 信息。</li><li>Intel GPU TOP，上面那个插件依赖这个插件。</li><li>Intel GVT-g，允许向多个虚拟机和容器直通英特尔核显，适用于 5 到 10 代，如果使用 RDP 可能耗尽显存。</li><li>Disable Mitigation Settings，关闭安全缓解措施。</li><li>File Activity，监视文件读写，查找硬盘无法停转的原因时有帮助。</li><li>Open Files，同上。</li><li>Dynamix Active Streams，同上。</li><li>……</li></ul><h2 id="容器">容器</h2><p class="h2l-text-indent">需要 UPnP、DLNA 的容器必须将网络设为 <code>host</code>。</p><p class="h2l-text-indent"><code>Custom: br0</code> 的容器需启用 <code>主机访问自定义网络</code> 才可被其他网络类型的容器访问。</p><ul><li>xhofe/alist：<ul><li>挂载阿里云盘的根目录时，<code>根目录ID</code> 填 <code>root</code>。</li><li>垃圾：<code>/data/log</code>。</li></ul></li><li>0netx/bw-export:latest，不支持设置 <code>UMASK</code>。</li><li>selenium/standalone-chrome，额外参数 <code>--shm-size 2g</code>，不支持设置 UID 等。</li><li>linuxserver/changedetection.io：<ul><li>额外增加环境变量 <code>LC_ALL</code>：<code>en_US.UTF-8</code>，见 <a target="_blank" rel="noopener" href="https://github.com/dgtlmoon/changedetection.io/issues/2486#issuecomment-2239207306">&quot;Exception: charmap codec can t decode byte 0x81 in position 440: character maps to<undefined>&quot;</undefined></a>。</li></ul></li><li>allanpk716/chinesesubfinder：<ul><li>将 <code>/mnt/user/dnml/</code> 映射为 <code>/media/dnml</code>，否则 CSF 会提示在容器内可能因为权限原因无法读取 <code>/media</code> 之外的目录。这项配置也会影响 MP 的 CSF 字幕下载插件的配置，具体见下文。</li><li>垃圾：<code>/config/Logs</code>。</li></ul></li><li><s>dreamacro/clash-premium，网络设为 <code>host</code>，不支持设置 UID 等：</s><ul><li><s>Clash 核心删库后改为 metacubex/mihomo，网络设为 <code>br0</code>，不支持设置 UID 等。</s> 代理改为放在路由器上。</li><li><code>proxy-providers</code> 由自建 <a target="_blank" rel="noopener" href="https://github.com/qier222/proxy-provider-converter">Proxy Provider Converter</a> 生成。</li><li><code>rule-providers</code> 采用 <a target="_blank" rel="noopener" href="https://github.com/Loyalsoldier/clash-rules">clash-rules</a>（其中 Google 服务调整为使用代理），由自建 <a target="_blank" rel="noopener" href="https://github.com/hunshcn/gh-proxy">gh-proxy</a> 加速。</li></ul></li><li>linuxserver/code-server，<code>DOCKER_MODS</code> 设为 <code>linuxserver/mods:code-server-nodejs</code>，<code>NODEJS_MOD_VERSION</code> 设为 <code>20</code>，<code>PROXY_DOMAIN</code> 设为 <s><code>&#123;&#123;port&#125;&#125;.&#123;&#123;host&#125;&#125;</code></s> <code>cs.nas.&lt;域名&gt;:&lt;端口&gt;</code>，参考<a target="_blank" rel="noopener" href="https://www.linuxserver.io/blog/2019-09-14-customizing-our-containers">“Customizing our Containers”</a>设置自定义脚本，不应设置 <code>UMASK</code> 否则 npm 等会报权限不安全。运营商似乎封锁了 22 端口，导致我没办法 push 到 GitHub，所以在 <code>.ssh</code> 目录下新建配置文件，写入主机配置，见<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/521340971">此文章</a>：<ul><li>映射 <code>/config/.cache</code> 为 <code>/mnt/user/large_temp/appdata/code-server/cache/</code>，否则会大量占用 appdata 的空间。</li><li>垃圾：<code>/config/data/logs</code>、<code>/config/data/User/History</code>（历史记录，可能有用）。</li></ul></li><li>library/couchdb，额外参数 <code>--user 99</code>，不支持设置 PID 和 UMASK。</li><li><s>newfuture/ddns，不支持设置 UID 等。</s> DDNS 改为放在路由器上。</li><li>80x86/filebrowser:2.10.3-amd64：<ul><li><code>/mnt/user/</code> 映射为 <code>/myfiles/user_shares</code>（注意，<code>/myfiles</code> 部分是必不可少的，否则解压文件时会报“文件不存在”的错误）。</li><li><code>/mnt/user/large_temp/appdata/filebrowser/thumbnail_cache/</code> 映射为 <code>/thumbnail_cache</code>。</li><li><code>/mnt/user/large_temp/appdata/filebrowser/index_db/</code> 映射为 <code>/index_db</code>，添加核显设备 <code>/dev/dri/renderD128</code>。</li><li>admin 的目录范围设置为 <code>./user_shares</code>。</li><li>Hollis 的目录范围设置为 <code>./user_shares/user_hollis</code>。</li></ul></li><li>iyuucn/iyuuplus，不支持设置 UID 等。</li><li>linuxserver/jellyfin，支持设定 UID、PID、UMASK 等：<ul><li>除了常规的配置路径映射外，还做以下映射：<ul><li><code>/mnt/user/large_temp/appdata/Jellyfin/cache/</code> 映射为 <code>/jellyfin_cache</code>，作为缓存路径。</li><li><code>/mnt/user/large_temp/appdata/Jellyfin/transcodes/</code> 映射为 <code>/jellyfin_transcodes</code>，作为转码路径。</li><li><code>/mnt/user/large_data/appdata/Jellyfin/metadata/</code> 映射为 <code>/jellyfin_metadata</code>，作为元数据路径，元数据存在 large_data 而非 large_temp。</li></ul></li><li>在我的硬件下需关闭 AV1 硬解和低电压模式硬件编码器。</li><li>通过 <code>universal-package-install</code> 和 <code>fonts-noto-cjk-extra</code> 解决媒体库封面文字变成方块的问题。</li><li>垃圾：<code>/config/log</code>。</li></ul></li><li>ghcr.io/feederbox826/stash-s6:hwaccel，不支持 UMASK，非兼容模式不支持设置 UID 等：<ul><li>端口用默认的 <code>9999</code>，否则插件运行可能有问题。</li><li>刮削的片名、演员名、标签等数据建议是 ASCII 字符，否则导出元数据时可能遇到问题。</li></ul></li><li>guovern/iptv-api，不支持设定 UID、PID、UMASK 等：<ul><li>遇到了 <code>ffprobe segfault</code> 错误，找到了<a target="_blank" rel="noopener" href="https://github.com/Guovin/iptv-api/issues/829">解决方案</a>。</li></ul></li><li>ich777/krusader。</li><li>jxxghp/moviepilot：<ul><li>详细配置在环境变量与配置页面里，这里不赘述。</li><li>CSF 字幕下载插件的“本地路径”指的是 MP 内的路径，“远程路径”指的是 CSF 内的路径；因此在我的案例中，前者填 <code>/dnml</code>，后者填 <code>/media/dnml</code>。</li><li>垃圾：<code>/config/logs</code>。</li></ul></li><li>cym1102/nginxwebui，网络设为 <code>host</code>，不支持设置 UID 等，开启特权，端口通过 <code>BOOT_OPTIONS</code> 指定：<ul><li>映射 <code>/home/nginxWebUI/log</code> 为 <code>/mnt/user/large_temp/appdata/nginxWebUI/log/</code>，<code>/etc/logrotate.d</code> 为 <code>/mnt/user/appdata/nginxWebUI/config/logrotate.d/</code> 并配置日志轮换，日志轮换配置所有者为 <code>root</code>，不允许其他用户写入。</li><li>具体配置见下文。</li></ul></li><li>linuxserver/qbittorrent，网络设为 <code>br0</code>：<ul><li>垃圾：<code>/config/qBittorrent/logs</code>。</li></ul></li><li>linuxserver/transmission，网络设为 <code>br0</code>。</li><li>louislam/uptime-kuma，不支持设置 UID 等：<ul><li>设置里的 <code>站点主 URL</code> 最后不要加斜杠，它拼接的时候自动加。</li><li>Unraid webGui 的 Url 应在最后加上 <code>/login</code>。</li><li>Transmission 可用 HTTP 基础身份验证，有效状态码 <code>200-299</code>。</li><li>Clash 不能用 HTTP 基础身份验证，有效状态码在 <code>200-299</code> 的基础上还需添加 <code>401</code>。</li></ul></li><li><s>linuxserver/fail2ban，网络设为 <code>host</code>，主机日志路径映射只读，额外参数 <code>--cap-add=NET_ADMIN --cap-add=NET_RAW</code> 允许修改防火墙：</s><ul><li><s>自定义配置文件应该以 <code>.local</code> 结尾，见<a target="_blank" rel="noopener" href="https://github.com/linuxserver/fail2ban-confs">“Configuration README”</a>;</s></li><li><s>我装这个是因为有王八犊子 SSH 爆破，刷了好多日志，估计是映射的端口被扫出来了吧，现在我把映射关了；</s></li><li><s>Unraid webGui 自带多次尝试失败暂时封禁的功能，所以不用在 fail2ban 里配置：</s><ul><li><s>我使用 nginx 反向代理 Unraid webGui，然而 Unraid webGui 似乎不会读取 <code>X-Real-IP</code> 标头，如果某一 IP 远程登录多次失败，会导致所有远程 IP 暂时无法登录。</s></li></ul></li><li><s>设置增量封禁，忽略局域网地址。</s></li><li>不再使用，因为关闭了端口映射。</li></ul></li><li>linuxserver/duplicati，UID、PID 设为 <code>0</code>，不然无法备份与恢复 <code>/boot</code>：<ul><li>分块大小设为 2 GB。</li><li>在 large_temp 上映射临时路径 <code>/temp_dir</code>，然后去高级选项保存，否则备份大文件时可能占满容器空间。</li><li><s>Flash（/boot）备份，每周二 5 点</s> 现在随 CA 一同由 CA Auto Update Applications 备份。</li><li>CA 备份上云，每周二 5 点，此策略仅为本地与云端备份同步，云端保留一份备份即可。</li><li>VM 备份上云，每周五 13 点，此策略仅为本地与云端备份同步，云端保留一份备份即可。</li><li>user_hollis 备份，每周二 5 点 30。</li><li>user_guest 备份，每周二 6 点。</li><li>gallery 备份，每周三 5 点。</li></ul></li><li>easychen/cookiecloud，不支持也不用设置 UID 等。</li><li><s>adguard/adguardhome，因 53 端口冲突，需网络设为 <code>custom: br0</code>，固定 IP 地址 <code>192.168.31.2</code>，不支持设置 UID 等：</s><ul><li><s>IPv6 地址是不固定的，没法将 IPv6 的 DNS 设为 AdGuard Home 的地址，所以按照前文所述，将 IPv6 的 DNS 设为无效地址，让路由器为 IPv6 使用 IPv4 DNS。</s></li><li>我觉得如果我不需要通过 WireGuard 访问 AdGuard Home，就不需要关闭 <code>本地服务器使用网络地址转换(NAT)</code>，静态路由表也不是必须的，但实际上我只要开了 <code>主机访问自定义网络</code>，WireGuard 就报废，所以等我解决了 WireGuard 要求的静态路由表的设置再使用 AdGuard Home。</li></ul></li><li>whyour/qinglong，不支持设置 UID 等。</li><li>……</li></ul><h2 id="虚拟机">虚拟机</h2><p class="h2l-text-indent">都删了，以下是旧的配置。</p><ul><li>Windows 10：<ul><li>机器：<code>Q35-7.1</code>。</li><li>BIOS：<code>SeaBIOS</code>，在我的情况中只有这个好使。</li><li>USB 控制器：<code>3.0 (nec XHCI)</code>。</li><li>虚拟磁盘总线：<code>VirtIO</code>。</li><li>Unraid 共享模式：<code>VirtIOFS</code>，<code>Manual</code>，<code>/mnt/user/</code>，<code>user_shares</code>。</li><li>显卡：<code>虚拟</code>，通过 Intel GVT-g 分配核显，但在这里选虚拟。<ul><li>需要注意的是，若开启 Intel GVT-g，使用 RDP 可能耗尽显存使虚拟机和 Unraid webGui 失去响应，但我使用 ToDesk 遇到了同样的情况。</li></ul></li><li>虚拟控制台视频驱动：<code>QXL (best)</code>。</li><li>网络资源：<code>br0</code>。</li><li>网络模式：<code>virtio-net</code>。</li><li>XML 视图下在 <code>&lt;/devices&gt;</code> 前插入 <code>&lt;sound model='ich6'/&gt;</code> 以启用声卡，每次编辑虚拟机后都需要重新插入，在 ToDesk 中记得开启被控电脑声音。</li><li>安装操作系统时需安装 VirtIO 驱动程序，暂时只装 Balloon、NetKVM、vioserial、viostor，guest 工具也不装，装多了可能出问题，比如鼠标指针丢失。</li><li>关闭一些功能，见 <a target="_blank" rel="noopener" href="https://docs.unraid.net/unraid-os/manual/vm-support/">VM Support</a>。</li><li>挂载 Unraid 共享，这样大部分软件可以直接写入 Unraid 共享，并且管理文件也更加方便，但使用 Link Shell Extension 制作硬链接还需通过 SMB：<ul><li>运行 VirtIO 驱动镜像里的 <code>virtio-win-gt-x64.msi</code>，这次可以全部安装，然后将 <code>VirtIO-FS Service</code> 服务设为自动启动，安装 <a target="_blank" rel="noopener" href="https://winfsp.dev/rel/">WinFsp</a>。</li></ul></li></ul></li><li>Fedora，配置基本同上，Unraid 共享模式改为 <code>9p</code>；BIOS 用 SeaBIOS 就可以了，这样的虚拟机恢复备份比较容易，不需要手动恢复选 OVMF 后多出来的文件。<ul><li>向 <code>/etc/fstab</code> 写入 <code>user_shares /user_shares 9p trans=virtio,version=9p2000.L,_netdev,rw 0 0</code> 自动挂载 Unraid 共享。</li></ul></li></ul><h2 id="反向代理（通过-nginxWebUI-设置）">反向代理（通过 nginxWebUI 设置）</h2><p class="h2l-text-indent">代理目标末尾通常不加 <code>/</code>，如 <code>http://192.168.xx.xx:pppp</code>，加 <code>/</code> 会导致 Jellyfin 的 WebSocket 出现问题。</p><h3 id="模板参数">模板参数</h3><ul><li>重定向到 Uptime Kuma 状态页：<code>return</code>：<code>302 https://status.&lt;域名&gt;:&lt;端口&gt;/</code>。</li><li>设置超时：<ul><li><code>proxy_read_timeout</code>：<code>24h</code>。</li><li><code>proxy_send_timeout</code>：<code>24h</code>。</li><li><code>proxy_connect_timeout</code>：<code>24h</code>。</li></ul></li><li>关闭缓冲区：<code>proxy_buffering</code>：<code>off</code>。</li><li>设置最大请求体大小：<code>client_max_body_size</code>：<code>30g</code>。</li><li>返回 <code>404</code>：<code>return</code>：<code>404</code>。</li><li>返回 <code>403</code>：<code>return</code>：<code>403</code>。</li></ul><h3 id="设置-2">设置</h3><ul><li>证书：<ul><li><code>*.cs.nas.&lt;域名&gt;</code>，用于 code-server 端口代理。</li><li><code>nas.&lt;域名&gt;</code>。</li><li><code>*.nas.&lt;域名&gt;</code>。</li></ul></li><li>监听 IPv6，开启 HTTP/2（新版写法），TLS 1.2、1.3，设置 Host 参数为 <code>$host</code>，额外参数一律在 location 处设置。</li><li>已关闭部分反向代理。</li><li><code>cdb.nas.&lt;域名&gt;</code>，CouchDB，无特殊设置。</li><li><code>cdio.nas.&lt;域名&gt;</code>，ChangeDetection，无特殊设置。</li><li><code>nginx.nas.&lt;域名&gt;</code>，nginxWebUI，无特殊设置。</li><li><code>dupl.nas.&lt;域名&gt;</code>，Duplicati，启用 WebSocket。</li><li><code>cc.nas.&lt;域名&gt;</code>，CookieCloud，无特殊设置。</li><li><code>ma.nas.&lt;域名&gt;</code>，MYZXKSAssistant，无特殊设置，已禁用。</li><li><code>iyuu.nas.&lt;域名&gt;</code>，IYUU，启用 WebSocket。</li><li><code>*.cs.nas.&lt;域名&gt;</code>，code-server 端口代理，启用 WebSocket。</li><li><s><code>clash.nas.&lt;域名&gt;</code>，Clash（mihomo），启用 WebSocket。</s></li><li><code>status.nas.&lt;域名&gt;</code>，Uptime Kuma，启用 WebSocket。</li><li><code>csf.nas.&lt;域名&gt;</code>，ChineseSubFinder，启用 WebSocket。</li><li><code>ql.nas.&lt;域名&gt;</code>，青龙面板，启用 WebSocket，已禁用。</li><li><code>fb.nas.&lt;域名&gt;</code>，filebrowser，启用 WebSocket，Host 参数：<code>$host:$server_port</code>，设置最大请求体大小，设置超时。</li><li><code>cs.nas.&lt;域名&gt;</code>，code-server，启用 WebSocket，<code>proxy_set_header</code>：<code>Accept-Encoding gzip</code>。</li><li><code>tr.nas.&lt;域名&gt;</code>，Transmission，设置最大请求体大小。</li><li><code>qb.nas.&lt;域名&gt;</code>，qBittorrent，设置最大请求体大小。</li><li><code>alist.nas.&lt;域名&gt;</code>，AList，设置最大请求体大小，设置超时，<a target="_blank" rel="noopener" href="https://github.com/alist-org/alist/discussions/3302#discussioncomment-6368900">Host 参数：$http_host</a>。</li><li><code>jlf.nas.&lt;域名&gt;</code>，Jellyfin：<ul><li><code>/</code> 设置最大请求体大小，关闭缓冲区。</li><li><code>/socket</code> 启用 WebSocket。</li></ul></li><li><code>stash.nas.&lt;域名&gt;</code>，Stash，设置最大请求体大小，关闭缓冲区，Host 参数：<code>$host:$server_port</code>，启用 WebSocket，设置超时。</li><li><code>iptvstrm.nas.&lt;域名&gt;</code>，iptv-api，无特殊设置。</li><li><code>nas.&lt;域名&gt;</code>，自定义 location，返回 <code>403</code>。</li><li><code>*.nas.&lt;域名&gt;</code>，未匹配的子域名，自定义 location，返回 <code>403</code>。</li><li><code>kr.nas.&lt;域名&gt;</code>，Krusader：<ul><li><code>= /</code> 无特殊设置。</li><li><code>/</code> 启用 WebSocket。</li><li><code>/websockify</code> 启用 WebSocket，设置超时，关闭缓冲区。</li></ul></li><li><code>unraid.nas.&lt;域名&gt;</code>，Unraid webGui，启用 WebSocket，Host 参数：<code>$host:$server_port</code>，设置最大请求体大小，设置超时。</li><li><code>mp.nas.&lt;域名&gt;</code>，MediaPilot，Host 参数：<code>$host:$server_port</code>。</li><li>……</li></ul><hr><p>未完待续……？</p></div></article><nav id="tide-page-nav" class="un-flex un-flex-wrap un-justify-between un-gap-4 un-my-4"><a class="un-sc-link-plain un-text-txt-scnd! un-me-auto" title="上一篇" href="/zh-CN/posts/89ce6dc2.html"><i class="fa-solid fa-angle-left un-me-1" aria-hidden="true"></i><span>我大部分的自卑与自负都来源于肥胖</span></a> <a class="un-sc-link-plain un-text-txt-scnd! un-ms-auto" title="下一篇" href="/zh-CN/posts/7de35aff.html"><span>傍晚的江畔</span><i class="fa-solid fa-angle-right un-ms-1" aria-hidden="true"></i></a></nav><aside id="tide-page-interactions" class="un-mt-4"><div class="un-mb-4"><h2 class="un-inline-block un-align-middle un-m-0 un-me-4 un-text-2xl un-font-bold"><label for="tide-select-active-interaction">互动</label></h2><select id="tide-select-active-interaction" name="tide-active-interaction" class="un-sc-select-plain un-align-bottom"><option value="twikoo">Twikoo</option><option value="webmentionjs">webmention.js</option></select></div><div id="tide-active-interaction"><div id="tide-interaction-twikoo-wrapper" style="display:none" dir="ltr"><div id="tide-interaction-twikoo"></div><script src="https://s4.zstatic.net/ajax/libs/twikoo/1.6.41/twikoo.all.min.js" integrity="sha512-cdLlE9nnzcJXQoy9eFuzGcpQXx70rXxmUNpvrvYTAwQv2txLSdvEUs+eILIyKVFBvAoUm9iUR73ewSD3IiGZ&#x2F;w&#x3D;&#x3D;" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script><script>"use strict";window.tideInteractions||(window.tideInteractions={}),window.tideInteractions.twikoo={load:function(){let t=getPageLang().toLowerCase();t in{zh:0,"zh-cn":0,"zh-hk":1,"zh-tw":2,"en-us":3,"en-gb":3,en:3,uz:4,"uz-uz":4,ja:5,"ja-jp":5}||(t="en"),void 0===this.load.twikooInited&&(this.load.twikooInited=!1),document.getElementById("tide-interaction-twikoo-wrapper").style.display="block",this.load.twikooInited||twikoo.init({envId:clientCtx.interactions.twikoo.env_id,el:"#tide-interaction-twikoo",region:clientCtx.interactions.twikoo.region,path:window.location.pathname,lang:t}).then((()=>{this.load.twikooInited=!0}))},unload:function(){document.getElementById("tide-interaction-twikoo-wrapper").style.display="none"}}</script></div><div id="tide-interaction-webmentionjs-wrapper" style="display:none"><div id="tide-interaction-webmentionjs"></div><link rel="stylesheet" href="/zh-CN/css/third-party/webmention.css"><script src="/zh-CN/js/third-party/webmention.js" data-id="tide-interaction-webmentionjs" defer data-max-webmentions="30" data-sort-by="published" data-sort-dir="up"></script><script>"use strict";window.tideInteractions||(window.tideInteractions={}),window.tideInteractions.webmentionjs={load:function(){document.getElementById("tide-interaction-webmentionjs-wrapper").style.display="block"},unload:function(){document.getElementById("tide-interaction-webmentionjs-wrapper").style.display="none"},i18n:function(n){return clientCtx.interactions.webmentionjs.i18n[n]||n}}</script></div></div><script>"use strict";!function(){let t;function n(n){const e=document.getElementById("tide-select-active-interaction");function o(){for(const n in window.tideInteractions)if(Object.prototype.hasOwnProperty.call(window.tideInteractions,n)){const e=window.tideInteractions[n];n===t?e.load():e.unload()}}e.addEventListener("change",(function(n){t=e.value,o()})),t=e.value,o()}"loading"!==document.readyState?n():document.addEventListener("DOMContentLoaded",n)}()</script></aside><div id="tide-floating-utils" class="un-fixed un-bottom-16 un-end-4 un-max-h-1/2 un-flex un-flex-col un-flex-wrap-reverse un-gap-2"><button id="tide-btn-scroll-to-top" class="un-sc-btn-default un-size-12" title="回到顶部"><i class="fa-solid fa-arrow-up" aria-hidden="true"></i></button> <button id="tide-btn-open-toc" class="un-sc-btn-default un-size-12" title="打开目录"><i class="fa-solid fa-bars-staggered" aria-hidden="true"></i></button></div></main></div></div><dialog id="tide-dialog-image-viewer" class="tide-dialog un-sc-dlg-fullscreen"><div class="tide-dialog-mask un-sc-dlg-mask"><img id="tide-viewing-image" tabindex="0"></div><div id="tide-image-viewer-toolbar" class="tide-dialog-container un-bg-black/75 un-fixed un-bottom-0 un-left-1/2 -un-translate-x-1/2 un-p-4 un-mb-4 un-w-100 un-max-w-full un-max-h-2/5 un-rounded-2xl un-text-base un-text-white un-overflow-auto"><div id="tide-viewing-image-title" class="un-mb-2 un-text-center un-text-xl"></div><div id="tide-image-viewer-counter" class="un-mb-4 un-text-center"></div><div id="tide-image-viewer-controls" class="un-flex un-flex-wrap un-justify-between un-gap-4 un-mx-auto"><button id="tide-image-viewer-btn-prev" class="un-sc-btn-default un-bg-transparent un-text-white un-border-white un-rounded-full un-size-12 un-shrink-0" title="上一张"><i class="fa-solid fa-angle-left" aria-hidden="true"></i></button> <button id="tide-image-viewer-btn-next" class="un-sc-btn-default un-bg-transparent un-text-white un-border-white un-rounded-full un-size-12 un-shrink-0" title="下一张"><i class="fa-solid fa-angle-right" aria-hidden="true"></i></button> <button id="tide-image-viewer-btn-zoom-in" class="un-sc-btn-default un-bg-transparent un-text-white un-border-white un-rounded-full un-size-12 un-shrink-0" title="放大"><i class="fa-solid fa-magnifying-glass-plus" aria-hidden="true"></i></button> <button id="tide-image-viewer-btn-zoom-out" class="un-sc-btn-default un-bg-transparent un-text-white un-border-white un-rounded-full un-size-12 un-shrink-0" title="缩小"><i class="fa-solid fa-magnifying-glass-minus" aria-hidden="true"></i></button> <button id="tide-image-viewer-btn-close" class="un-sc-btn-default un-bg-transparent un-text-white un-border-white un-rounded-full un-size-12 un-shrink-0" title="关闭"><i class="fa-solid fa-xmark" aria-hidden="true"></i></button> <button id="tide-image-viewer-btn-collapse-toolbar" class="un-sc-btn-default un-bg-transparent un-text-white un-border-white un-rounded-full un-size-12 un-shrink-0" title="折叠工具栏"><i class="fa-solid fa-down-left-and-up-right-to-center" aria-hidden="true"></i></button></div></div><div id="tide-image-viewer-mini-toolbar" class="un-bg-black/75 un-fixed un-bottom-0 un-end-0 un-m-4 un-p-2 un-rounded-full un-text-base un-text-white"><div id="tide-image-viewer-mini-controls" class="un-flex un-flex-wrap un-justify-between un-gap-2 un-mx-auto"><button id="tide-image-viewer-btn-close-2" class="un-sc-btn-default un-bg-transparent un-text-white un-border-white un-rounded-full un-size-12 un-shrink-0" title="关闭"><i class="fa-solid fa-xmark" aria-hidden="true"></i></button> <button id="tide-image-viewer-btn-expand-toolbar" class="un-sc-btn-default un-bg-transparent un-text-white un-border-white un-rounded-full un-size-12 un-shrink-0" title="展开工具栏"><i class="fa-solid fa-up-right-and-down-left-from-center" aria-hidden="true"></i></button></div></div></dialog><script src="/zh-CN/js/third-party/pinch-zoom.umd.min.js" defer></script><script>"use strict";!function(){function e(e){const t=document.getElementById("tide-dialog-image-viewer"),n=document.querySelector(".tide-dialog-mask:has(#tide-viewing-image)"),o=document.getElementById("tide-image-viewer-toolbar"),i=document.getElementById("tide-viewing-image"),a=document.getElementById("tide-viewing-image-title"),r=document.getElementById("tide-image-viewer-counter"),d=document.getElementById("tide-image-viewer-btn-prev"),s=document.getElementById("tide-image-viewer-btn-next"),c=document.getElementById("tide-image-viewer-btn-zoom-in"),l=document.getElementById("tide-image-viewer-btn-zoom-out"),m=document.getElementById("tide-image-viewer-btn-close"),u=document.getElementById("tide-image-viewer-btn-close-2"),f=document.getElementById("tide-image-viewer-btn-collapse-toolbar"),g=document.getElementById("tide-image-viewer-mini-toolbar"),v=document.getElementById("tide-image-viewer-btn-expand-toolbar"),y=!!isPageRtl(),p=new PinchZoom.default(i,{listenOnElementNotContainer:!0,useMouseWheel:!0,rtl:y,minZoom:.25,maxZoom:4,zoomOutFactor:0,onDragStart:function(e,t){i.style.cursor="grabbing"},onDragEnd:function(e,t){i.style.cursor="grab"}});p.enable();const w={"user-drag":"none","-webkit-user-drag":"none","user-select":"none","-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none",cursor:"grab"};for(const e in w)Object.prototype.hasOwnProperty.call(w,e)&&(i.style[e]=w[e]);i.addEventListener("dragstart",(()=>{}));const b=[...document.querySelectorAll("#tide-page .un-prose :not(a)>img:not([display=none]):not(.tide-hidden-to-image-viewer), #tide-post .un-prose :not(a)>img:not([display=none]):not(.tide-hidden-to-image-viewer)")],E=b.length;for(const e of b)e.style.cursor="zoom-in",e.addEventListener("click",(function(e){h=b.indexOf(e.target),z()})),e.addEventListener("keydown",(function(e){"Enter"===e.key&&(e.preventDefault(),h=b.indexOf(e.target),z())}));let h;function k(e){const t=b[e];i.src=t.src,i.alt=t.alt,t.title?(i.title=t.title,a.textContent=t.title,a.style.display="block"):(i.title="",a.textContent="",a.style.display="none"),r.textContent=h+1+clientCtx.progress_marker+E,p.zoomFactor=1,p.lastScale=1,p.resetOffset()}function x(){h<=0?h=E-1:--h,k(h)}function L(){h>=E-1?h=0:++h,k(h)}function I(e){const t=p.getInitialZoomFactor()*p.zoomFactor,n={x:-p.offset.x+p.el.offsetWidth*t/2,y:-p.offset.y+p.el.offsetHeight*t/2},o=Math.max(Math.min(p.options.maxZoom,p.lastScale+e),p.options.minZoom),i=o/p.lastScale;p.scale(i,n),p.lastScale=o,p.update()}function B(e){const t=p.getInitialZoomFactor()*p.zoomFactor,n={x:-p.offset.x+p.el.offsetWidth*t/2,y:-p.offset.y+p.el.offsetHeight*t/2},o=Math.min(Math.max(p.options.minZoom,p.lastScale-e),p.options.maxZoom),i=o/p.lastScale;p.scale(i,n),p.lastScale=o,p.update()}function D(e){p.offset.x+=e.x,p.offset.y+=e.y,p.offset=p.sanitizeOffset(p.offset),p.update()}function A(e){D({x:0,y:-e})}function S(e){D({x:-e,y:0})}function z(){k(h),t.showModal(),s.focus()}function O(){o.removeAttribute("hidden"),g.setAttribute("hidden",""),s.focus()}d.addEventListener("click",(()=>{x()})),s.addEventListener("click",(()=>{L()})),c.addEventListener("click",(()=>{I(.2)})),l.addEventListener("click",(()=>{B(.2)})),m.addEventListener("click",(()=>{t.close()})),u.addEventListener("click",(()=>{t.close()})),f.addEventListener("click",(()=>{o.setAttribute("hidden",""),g.removeAttribute("hidden"),i.focus()})),v.addEventListener("click",(()=>{O()})),i.addEventListener("keydown",(function(e){const t=n.offsetWidth/20,o=n.offsetHeight/20;switch(e.key){case"ArrowUp":A(-t),e.preventDefault(),e.stopPropagation();break;case"ArrowDown":A(t),e.preventDefault(),e.stopPropagation();break;case"ArrowLeft":S(-o),e.preventDefault(),e.stopPropagation();break;case"ArrowRight":S(o),e.preventDefault(),e.stopPropagation()}})),t.addEventListener("keydown",(function(e){switch(e.key){case"ArrowUp":I(.1),e.preventDefault();break;case"ArrowDown":B(.1),e.preventDefault();break;case"ArrowLeft":y?L():x(),e.preventDefault();break;case"ArrowRight":y?x():L(),e.preventDefault()}})),O()}"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e),window.addEventListener("hexo-blog-decrypt",(()=>{e()}))}()</script><dialog id="tide-dialog-toc" class="tide-dialog un-sc-dlg-fullscreen"><div class="tide-dialog-mask un-sc-dlg-mask"><div id="tide-toc-panel" class="tide-side-panel un-fixed un-end-0 un-h-full un-bg-bg-scnd un-flex un-flex-col"><div class="un-w-full un-p-4 un-flex-none un-flex un-justify-between un-gap-4"><h2 class="un-m-0 un-text-2xl un-font-bold un-leading-12 un-overflow-hidden un-text-ellipsis">目录</h2><button id="tide-toc-btn-close" class="un-sc-btn-default un-flex-none un-size-12" title="关闭"><i class="fa-solid fa-close" aria-hidden="true"></i></button></div><div id="tide-toc-content" class="tide-side-panel-content un-w-full un-p-4 un-h-full un-grow-1 un-shrink-1 un-overflow-auto"><ol class="tide-toc"><li class="tide-toc-item tide-toc-level-2"><a class="tide-toc-link" href="#Unraid-OS-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="tide-toc-text">Unraid OS 注意事项</span></a><ol class="tide-toc-child"><li class="tide-toc-item tide-toc-level-3"><a class="tide-toc-link" href="#%E8%AE%BE%E7%BD%AE"><span class="tide-toc-text">设置</span></a></li><li class="tide-toc-item tide-toc-level-3"><a class="tide-toc-link" href="#%E9%98%B5%E5%88%97%E4%B8%8E%E6%B1%A0"><span class="tide-toc-text">阵列与池</span></a></li><li class="tide-toc-item tide-toc-level-3"><a class="tide-toc-link" href="#%E5%85%B1%E4%BA%AB"><span class="tide-toc-text">共享</span></a></li><li class="tide-toc-item tide-toc-level-3"><a class="tide-toc-link" href="#%E6%8F%92%E4%BB%B6"><span class="tide-toc-text">插件</span></a></li></ol></li><li class="tide-toc-item tide-toc-level-2"><a class="tide-toc-link" href="#%E5%AE%B9%E5%99%A8"><span class="tide-toc-text">容器</span></a></li><li class="tide-toc-item tide-toc-level-2"><a class="tide-toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="tide-toc-text">虚拟机</span></a></li><li class="tide-toc-item tide-toc-level-2"><a class="tide-toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%EF%BC%88%E9%80%9A%E8%BF%87-nginxWebUI-%E8%AE%BE%E7%BD%AE%EF%BC%89"><span class="tide-toc-text">反向代理（通过 nginxWebUI 设置）</span></a><ol class="tide-toc-child"><li class="tide-toc-item tide-toc-level-3"><a class="tide-toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%8F%82%E6%95%B0"><span class="tide-toc-text">模板参数</span></a></li><li class="tide-toc-item tide-toc-level-3"><a class="tide-toc-link" href="#%E8%AE%BE%E7%BD%AE-2"><span class="tide-toc-text">设置</span></a></li></ol></li></ol></div></div></div></dialog><script>"use strict";!function(){function e(e){const t=document.getElementById("tide-dialog-toc"),n=document.querySelector("#tide-dialog-toc .tide-dialog-mask"),o=document.getElementById("tide-toc-panel"),d=document.getElementsByClassName("tide-toc-link"),c=document.getElementById("tide-toc-btn-close");n.addEventListener("click",(()=>{i()})),o.addEventListener("click",(function(e){e.stopPropagation()}));for(const e of d)e.addEventListener("click",(function(e){const t=decodeURIComponent(e.target.parentElement.href.split("#")[1]),n=document.getElementById(t);n&&(document.getElementById("tide-main-content").scrollTo({top:n.offsetTop-document.getElementById("tide-top-bar").clientHeight,behavior:"smooth"}),e.preventDefault()),i()}));function i(){t.close()}c.addEventListener("click",(()=>{i()}))}"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}()</script><dialog id="tide-dialog-search" class="tide-dialog un-sc-dlg-fullscreen"><div class="tide-dialog-mask un-sc-dlg-mask"><search id="tide-search-panel" class="un-absolute un-start-1/2 un-top-1/10 -un-translate-x-1/2 un-w-200 un-max-w-full un-h-4/5 un-flex un-flex-col un-justfy-between un-gap-1 un-overflow-hidden"><div class="un-w-full un-flex un-justify-between un-gap-1 un-flex-none"><input id="tide-search-box" class="un-sc-input-plain un-w-0 un-h-12 un-flex-1" type="search" placeholder="在此键入以搜索……" autocomplete="off"> <button id="tide-search-btn-close" class="un-sc-btn-plain un-size-12 un-flex-none" title="关闭"><i class="fa-solid fa-close" aria-hidden="true"></i></button></div><div class="un-bg-bg-scnd un-border-2 un-border-txt-prim un-border-solid un-w-full un-max-h-full un-overflow-auto"><p id="tide-search-result-placeholder" class="un-m-0 un-my-4 un-text-center">无数据</p><div id="tide-search-results" class="un-w-full un-px-4" style="display:none"></div></div></search></div></dialog><script src="/zh-CN/js/third-party/search.js" defer></script><script>"use strict";!function(){function e(e){const t=new LocalSearch({path:clientCtx.search_db_path});t.fetchData();const n=document.getElementById("tide-dialog-search"),d=document.querySelector("#tide-dialog-search .tide-dialog-mask"),i=document.getElementById("tide-search-panel"),c=document.getElementById("tide-search-box"),l=document.getElementById("tide-search-btn-close"),o=document.getElementById("tide-search-result-placeholder"),s=document.getElementById("tide-search-results");function a(){n.close()}d.addEventListener("click",(()=>{a()})),i.addEventListener("click",(function(e){e.stopPropagation()})),c.addEventListener("input",(()=>{!function(){if(!t.isfetched)return;const e=c.value.trim().toLowerCase(),n=e.split(/[-\s]+/);let d=[];e.length>0&&(d=t.getResultItems(n));1===n.length&&""===n[0]||0===d.length?(o.style.display="block",s.style.display="none"):(o.style.display="none",s.style.display="block",d.sort(((e,t)=>e.includedCount!==t.includedCount?t.includedCount-e.includedCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id)),s.innerHTML=`<ul id="tide-search-result-list">${d.map((e=>e.item)).join("")}</ul>`)}()})),l.addEventListener("click",(()=>{a()}))}"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}()</script><script src="/zh-CN/js/collapse.js"></script><script src="/shared/runtime-site-mod.js" defer></script><script>
    if(!('loading' in HTMLImageElement.prototype)) {
        const srp = document.createElement('script');
        srp.src = 'https://cdn.jsdelivr.net/npm/lazysizes@5.1.1/lazysizes.min.js';
        document.body.append(srp);
        const imgs = document.querySelectorAll('img');
        imgs.forEach(el => {
            el.setAttribute('data-src', el.getAttribute('src'));
            el.removeAttribute('src');
            el.classList.add('lazyload');
    })
}
</script></body></html>